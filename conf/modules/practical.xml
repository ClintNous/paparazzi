<!DOCTYPE module SYSTEM "module.dtd">

<module name="practical" dir="computer_vision">
  <doc>
    <description>
        Main practical module
    </description>
    
    <section name="PRACTICAL" prefix="PRACTICAL_">
    </section>
  </doc>
  
  
  <settings>
	  <dl_settings NAME="PRACTICAL Assignment">
      <dl_settings name="practical">
        <dl_setting var="practical.y_m" module="computer_vision/practical_module" min="-512" step="1" max="512" shortname="y_m" param="PRACTICAL_Y_m"/>
        <dl_setting var="practical.y_M" module="computer_vision/practical_module" min="-512" step="1" max="512" shortname="y_M" param="PRACTICAL_Y_M"/>
        <dl_setting var="practical.u_m" module="computer_vision/practical_module" min="-512" step="1" max="512" shortname="u_m" param="PRACTICAL_U_m"/>
        <dl_setting var="practical.u_M" module="computer_vision/practical_module" min="-512" step="1" max="512" shortname="u_M" param="PRACTICAL_U_M"/>
        <dl_setting var="practical.v_m" module="computer_vision/practical_module" min="-512" step="1" max="512" shortname="v_m" param="PRACTICAL_V_m"/>
        <dl_setting var="practical.v_M" module="computer_vision/practical_module" min="-512" step="1" max="512" shortname="v_M" param="PRACTICAL_V_M"/>
        <dl_setting var="practical.trigger_thres" module="computer_vision/practical_module" min="0" step="1" max="255" shortname="thres" param="PRACTICAL_thres"/>
	<dl_setting var="matrix_treshold" module="computer_vision/practical_module" min="0" step="1" max="15" shortname="Matrix_Tres" param="Treshold"/>
	<dl_setting var="matrix_sum_treshold " module="computer_vision/practical_module" min="0" step="1" max="30" shortname="Matrix_Tres" param="Treshold"/>
        <dl_setting var="ref_pitch_angle" module="computer_vision/practical_module" min="-0.3" step="0.01" max="0.3" shortname="Ref_pitch" param="ref_pitch"/>
	<dl_setting var="c3" module="computer_vision/practical_module" min="0" step="0.1" max="10" shortname="c3" param="c3"/>
        
        <dl_setting var="practical_stab.phi_pgain" module="computer_vision/stabilization_practical" min="0" step="1" max="1000" shortname="kp_v_phi" param="PRACTICAL_PHI_PGAIN"/>
        <dl_setting var="practical_stab.phi_igain" module="computer_vision/stabilization_practical" min="0" step="1" max="1000" shortname="ki_v_phi" param="PRACTICAL_PHI_IGAIN"/>
        <dl_setting var="practical_stab.theta_pgain" module="computer_vision/stabilization_practical" min="0" step="1" max="1000" shortname="kp_v_theta" param="PRACTICAL_THETA_PGAIN"/>
        <dl_setting var="practical_stab.theta_igain" module="computer_vision/stabilization_practical" min="0" step="1" max="1000" shortname="ki_v_theta" param="PRACTICAL_THETA_IGAIN"/>
        <dl_setting var="practical_stab.desired_vx" module="computer_vision/stabilization_practical" min="-5" step="0.01" max="5" shortname="desired_vx" param="PRACTICAL_DESIRED_VX"/>
        <dl_setting var="practical_stab.desired_vy" module="computer_vision/stabilization_practical" min="-5" step="0.01" max="5" shortname="desired_vy" param="PRACTICAL_DESIRED_VY"/>
		
	<dl_setting var="alpha_fil" module="computer_vision/stabilization_practical" min="0" step="0.01" max="1" shortname="alpha_fil" param="ALPHA_FIL"/>
        <dl_setting var="v_desired" module="computer_vision/stabilization_practical" min="0" step="0.1" max="2" shortname="v_des" param="V_DES"/>
	
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="practical_module.h"/>
  </header>

  <init fun="practical_module_init()"/>
  <periodic fun="practical_module_run()" start="practical_module_start()" stop="practical_module_stop()" autorun="TRUE" freq="512"/>

  <makefile target="ap">
    <!-- Include the needed Computer Vision files -->
    <define name="modules/computer_vision" type="include"/>
    <file name="image.c" dir="modules/computer_vision/lib/vision"/>
    <file name="jpeg.c" dir="modules/computer_vision/lib/encoding"/>
    <file name="rtp.c" dir="modules/computer_vision/lib/encoding"/>
    <file name="v4l2.c" dir="modules/computer_vision/lib/v4l"/>

    <!-- The practical module itself -->
    <file name="practical_module.c"/>
    <file name="stabilization_practical.c"/>

    <!-- Random flags -->
    <flag name="LDFLAGS" value="static"/>

    <!-- Used for debug video -->
    <raw>
      ap.CFLAGS += -DUSE_UDP1 -DUDP1_PORT_OUT=5000 -DUDP1_PORT_IN=4999 -DUDP1_BROADCAST=TRUE -DUDP1_HOST=\"$(MODEM_HOST)\"
      ap.CFLAGS += -DPRACTICAL_UDP_DEV=udp1

      ap.CFLAGS += -DGUIDANCE_V_MODE_MODULE_SETTING=GUIDANCE_V_MODE_HOVER
      ap.CFLAGS += -DGUIDANCE_H_MODE_MODULE_SETTING=GUIDANCE_H_MODE_MODULE
    </raw>
  </makefile>

  <makefile target="nps">
    <!-- TODO -->
    <file name="viewvideo_nps.c"/>
  </makefile>

</module>